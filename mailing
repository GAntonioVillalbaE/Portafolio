// Mandar correos personalizados por gmail y guardar respuesta del receptor
function doGet(e) {
  var sheet = SpreadsheetApp.openById('').getActiveSheet(); // ID del sheets
  var response = e.parameter.response; // 'yes' or 'no'
  var email = e.parameter.email; // capture the email parameter
  sheet.appendRow([new Date(), email, response]);

  var htmlOutput = HtmlService.createHtmlOutputFromFile('responsePage')
                              .setWidth(400)
                              .setHeight(300);
  return htmlOutput;
}

function sendEmailWithButtons() {
  var recipients = [
    // añade tantos correos como necesites
  ];
  var subject = "Conecta con GAV ABOGADOS";
  var signature = Gmail.Users.Settings.SendAs.list("me").sendAs.filter(function(account){if(account.isDefault){return true}})[0].signature;
  var scriptUrl = 'https://script.google.com/macros/s/AKfycbywuMPy7rPg0s4H38mN62rVe0KW4RdUDz26b3_ZYCzjTOE8b6D-PmAJzXFqS1BPd_IwpA/exec';
  for (var i = 0; i < recipients.length; i++) {
    var recipient = recipients[i];
    var email = recipient.split('@')[0]; // Get the part before the '@'
    var yesUrl = scriptUrl + '?response=yes&email=' + encodeURIComponent(email);
    var noUrl = scriptUrl + '?response=no&email=' + encodeURIComponent(email);
    var htmlBody = `
      <p>GAV Abogados tiene interés en estar en contacto con ustedes, clientes y aliados. 
      <br/>Además de nuestras instalaciones físicas, en donde te esperamos cuando así lo desees, puedes visitarnos en las redes sociales <a href="https://www.instagram.com/gav.abogados/">Instagram</a> y <a href="https://www.linkedin.com/company/gavbogados/">LinkedIn</a>. No dudes en consultarnos cuando tengas dudas e inquietudes legales en nuestras áreas de competencia.
      <br/>Si deseas continuar recibiendo nuestros correos informativos, confirma tu respuesta en el botón.</p>
      <a href="${yesUrl}" style="background-color:green;color:white;padding:10px 20px;text-decoration:none;border-radius:5px;font-size:16px;margin-right:10px;">Sí</a>
      <a href="${noUrl}" style="background-color:red;color:white;padding:10px 20px;text-decoration:none;border-radius:5px;font-size:16px;">No</a>
      <p>${signature}</p>
      `;
    
    GmailApp.sendEmail(recipient, subject, '', {
      htmlBody: htmlBody
    });
  }
}
